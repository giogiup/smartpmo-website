<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartPMO.ai Operations Console</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect x='20' y='30' width='30' height='10' rx='3' fill='%23ff4444'/%3E%3Crect x='20' y='50' width='45' height='10' rx='3' fill='%23ff8800'/%3E%3Crect x='20' y='70' width='25' height='10' rx='3' fill='%23ffcc00'/%3E%3Ccircle cx='15' cy='35' r='5' fill='%23ff4444'/%3E%3Ccircle cx='15' cy='55' r='5' fill='%23ff8800'/%3E%3Ccircle cx='15' cy='75' r='5' fill='%23ffcc00'/%3E%3C/svg%3E">
    <style>
        :root{--bg-dark:#1a1a1a;--bg-card:#1e1e1e;--bg-panel:#2a2a2a;--text-light:#e0e0e0;--accent-red:#ff4444;--accent-orange:#ff8800;--accent-yellow:#ffcc00;--accent-green:#44ff44;--border-radius:8px;--gap:16px}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:var(--bg-dark);color:var(--text-light);padding-top:70px}
        #heroBar{position:fixed;top:0;left:0;right:0;height:60px;background:var(--bg-panel);display:flex;align-items:center;padding:0 20px;z-index:1000;border-bottom:2px solid var(--accent-orange)}
        #heroBar svg{height:36px;margin-right:10px}
        #heroBar h1{font-size:20px;color:var(--accent-yellow)}
        #liveClock{margin-left:auto;font-size:14px;color:var(--accent-orange)}
        .status-pill{padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600;text-transform:uppercase;margin-left:12px}
        .status-pill.connected{background:var(--accent-green);color:#000}
        .status-pill.error{background:var(--accent-red);color:#fff}
        nav{background:var(--bg-panel);padding:10px 20px;display:flex;gap:10px;border-radius:var(--border-radius);margin:0 20px 20px}
        nav button{background:var(--accent-red);color:#fff;border:none;padding:8px 16px;border-radius:var(--border-radius);cursor:pointer;font-weight:600;transition:background .2s}
        nav button:hover{background:var(--accent-orange)}
        nav button.active{background:var(--accent-yellow);color:#000}
        .page{display:none;padding:0 20px 20px}
        .page.active{display:block}
        h2{margin:10px 0;color:var(--accent-orange);font-size:18px}
        
        /* Discovery Dashboard */
        .dashboard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:var(--gap);margin-bottom:20px}
        .stat-card{background:var(--bg-panel);padding:20px;border-radius:var(--border-radius);border-left:4px solid var(--accent-orange)}
        .stat-card.premium{border-left-color:var(--accent-yellow)}
        .stat-card.success{border-left-color:var(--accent-green)}
        .stat-card.warning{border-left-color:var(--accent-orange)}
        .stat-card.error{border-left-color:var(--accent-red)}
        .stat-value{font-size:32px;font-weight:bold;color:var(--accent-yellow);margin-bottom:5px}
        .stat-label{font-size:14px;color:#aaa}
        .source-list{background:var(--bg-panel);border-radius:var(--border-radius);padding:15px;margin-top:20px}
        .source-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid #333;margin-bottom:5px}
        .source-item:last-child{border-bottom:none}
        .source-name{font-weight:600;color:var(--accent-yellow)}
        .source-stats{font-size:12px;color:#aaa}
        .source-status{padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600}
        .source-status.success{background:var(--accent-green);color:#000}
        .source-status.failed{background:var(--accent-red);color:#fff}
        
        /* Source Manager */
        .filter-bar{background:var(--bg-panel);padding:15px;border-radius:var(--border-radius);margin-bottom:20px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
        .filter-bar input[type="text"]{flex:1;min-width:200px;padding:8px;background:var(--bg-card);border:1px solid #444;border-radius:var(--border-radius);color:var(--text-light)}
        .filter-bar select{padding:8px;background:var(--bg-card);border:1px solid #444;border-radius:var(--border-radius);color:var(--text-light)}
        .source-card{background:var(--bg-panel);padding:15px;border-radius:var(--border-radius);margin-bottom:15px;border-left:4px solid var(--accent-orange)}
        .source-card.tier-1{border-left-color:var(--accent-red)}
        .source-card.tier-2{border-left-color:var(--accent-orange)}
        .source-card.tier-3{border-left-color:var(--accent-yellow)}
        .source-card.tier-4{border-left-color:#888}
        .source-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
        .source-card-title{font-size:16px;font-weight:600;color:var(--accent-yellow)}
        .source-card-meta{display:flex;gap:15px;font-size:13px;color:#aaa}
        .source-actions{display:flex;gap:5px}
        .source-actions button{padding:4px 10px;background:var(--accent-orange);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:11px}
        .source-actions button:hover{background:var(--accent-red)}
        .toggle-switch{position:relative;display:inline-block;width:50px;height:24px}
        .toggle-switch input{opacity:0;width:0;height:0}
        .toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#ccc;transition:.4s;border-radius:24px}
        .toggle-slider:before{position:absolute;content:"";height:16px;width:16px;left:4px;bottom:4px;background:white;transition:.4s;border-radius:50%}
        input:checked + .toggle-slider{background:var(--accent-green)}
        input:checked + .toggle-slider:before{transform:translateX(26px)}
        
        /* Other sections */
        .manual-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:var(--gap);margin:0}
        .manual-card{background:var(--bg-panel);border-radius:var(--border-radius);padding:20px;display:flex;flex-direction:column;border-left:6px solid var(--accent-red)}
        .manual-card.daily{border-left-color:var(--accent-red)}
        .manual-card.weekly{border-left-color:var(--accent-orange)}
        .manual-card.docs{border-left-color:var(--accent-yellow)}
        .manual-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}
        .manual-header span{font-size:20px}
        .manual-header h3{color:var(--accent-yellow);font-size:17px}
        .manual-list{display:flex;flex-direction:column;gap:8px}
        .manual-item{display:flex;align-items:flex-start;gap:10px;padding:6px 0;border-bottom:1px solid #333}
        .manual-item:last-child{border-bottom:none}
        .manual-item input[type=checkbox]{accent-color:var(--accent-orange);width:18px;height:18px;margin-top:2px}
        .manual-item label{font-size:14px;line-height:1.4;cursor:pointer}
        
        /* Kanban */
        #addTaskWrap{background:var(--bg-panel);border-radius:var(--border-radius);margin:0 0 20px;overflow:hidden}
        #addTaskHeader{display:flex;justify-content:space-between;align-items:center;padding:10px 15px;background:var(--accent-red);cursor:pointer}
        #addTaskHeader h2{margin:0;font-size:16px}
        #addTaskChevron{font-size:12px}
        #addTaskContent{max-height:0;transition:max-height .3s ease;overflow:hidden}
        #addTaskContent.open{max-height:500px}
        .add-form{padding:15px}
        .form-group{margin-bottom:10px}
        label{display:block;margin-bottom:4px;color:var(--accent-orange);font-weight:600}
        input,select,textarea{width:100%;padding:8px;background:var(--bg-card);border:1px solid #444;border-radius:var(--border-radius);color:var(--text-light)}
        button[type=submit]{background:var(--accent-orange);color:#fff;border:none;padding:10px 20px;border-radius:var(--border-radius);cursor:pointer;font-weight:600;margin-top:6px}
        .filters{display:flex;flex-wrap:wrap;gap:20px;margin:0 0 20px}
        .filter-group{background:var(--bg-panel);padding:10px 15px;border-radius:var(--border-radius)}
        .filter-group h3{color:var(--accent-yellow);font-size:15px;margin-bottom:6px}
        .filter-group label{display:flex;align-items:center;gap:6px;margin:4px 0;font-size:14px;font-weight:normal}
        .filter-group input[type=checkbox]{width:16px;height:16px;accent-color:var(--accent-orange)}
        .filter-buttons{display:flex;gap:6px;margin-top:6px}
        .filter-buttons button{background:var(--accent-yellow);color:#000;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;font-size:12px}
        .kanban{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:var(--gap);margin:0}
        .column{background:var(--bg-panel);border-radius:var(--border-radius);padding:12px}
        .column-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
        .column h3{color:var(--accent-yellow);font-size:16px}
        .count-pill{background:var(--accent-red);color:#fff;font-size:11px;padding:2px 8px;border-radius:10px}
        .card{background:var(--bg-card);border-left:4px solid var(--accent-red);padding:10px;margin-bottom:10px;border-radius:var(--border-radius);cursor:pointer;position:relative;animation:fadeIn .3s ease}
        @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .card.critical{border-left-color:#ff0044}
        .card.high{border-left-color:var(--accent-red)}
        .card.medium{border-left-color:var(--accent-orange)}
        .card.low{border-left-color:var(--accent-yellow)}
        .card-title{font-weight:600;margin-bottom:4px}
        .card-meta{font-size:12px;color:#aaa;display:flex;justify-content:space-between}
        .card-actions{position:absolute;top:4px;right:4px;display:none;gap:4px}
        .card:hover .card-actions{display:flex}
        .card-actions button{background:var(--accent-orange);color:#fff;border:none;padding:2px 6px;border-radius:4px;cursor:pointer;font-size:11px}
    </style>
</head>
<body>

<!-- Hero Bar -->
<div id="heroBar">
    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none">
        <rect x="4" y="6" width="8" height="2" rx="1" fill="var(--accent-red)"/>
        <rect x="4" y="10" width="12" height="2" rx="1" fill="var(--accent-orange)"/>
        <rect x="4" y="14" width="6" height="2" rx="1" fill="var(--accent-yellow)"/>
        <circle cx="3" cy="7" r="1.5" fill="var(--accent-red)"/>
        <circle cx="3" cy="11" r="1.5" fill="var(--accent-orange)"/>
        <circle cx="3" cy="15" r="1.5" fill="var(--accent-yellow)"/>
    </svg>
    <h1>SmartPMO.ai Operations Console</h1>
    <div id="liveClock"></div>
    <span id="dbStatus" class="status-pill connected">Connected</span>
</div>

<nav>
    <button class="active" onclick="showPage('discovery')">Discovery</button>
    <button onclick="showPage('sources')">Source Manager</button>
    <button onclick="showPage('backlog')">Backlog</button>
    <button onclick="showPage('operations')">Operations</button>
    <button onclick="showPage('manual')">Manual Tasks</button>
</nav>

<!-- DISCOVERY DASHBOARD -->
<div id="discovery" class="page active">
    <h2>üìä Discovery Dashboard</h2>
    
    <div class="dashboard-grid">
        <div class="stat-card success">
            <div class="stat-value" id="todayArticles">0</div>
            <div class="stat-label">Articles Discovered Today</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="todayScored">0</div>
            <div class="stat-label">Articles Scored</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="todayFetched">0</div>
            <div class="stat-label">Content Fetched (Top 20)</div>
        </div>
        <div class="stat-card premium">
            <div class="stat-value" id="todayCards">0</div>
            <div class="stat-label">Cards Generated</div>
        </div>
    </div>
    
    <div class="dashboard-grid">
        <div class="stat-card">
            <div class="stat-value" id="premiumCount">0</div>
            <div class="stat-label">Premium Articles (‚â•89)</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="sourcesActive">179</div>
            <div class="stat-label">Active Sources</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="runDuration">0m</div>
            <div class="stat-label">Last Run Duration</div>
        </div>
        <div class="stat-card" id="statusCard">
            <div class="stat-value" id="runStatus">Ready</div>
            <div class="stat-label">Pipeline Status</div>
        </div>
    </div>
    
    <div class="source-list">
        <h3 style="color:var(--accent-yellow);margin-bottom:15px">üì° Today's Top Sources</h3>
        <div id="topSources">
            <div style="color:#aaa;text-align:center;padding:20px">Loading...</div>
        </div>
    </div>
</div>

<!-- SOURCE MANAGER -->
<div id="sources" class="page">
    <h2>üîß Source Registry (179 Sources)</h2>
    
    <div class="filter-bar">
        <input type="text" id="sourceSearch" placeholder="Search sources..." onkeyup="filterSources()">
        <select id="tierFilter" onchange="filterSources()">
            <option value="">All Tiers</option>
            <option value="1">Tier 1 - Direct PMO</option>
            <option value="2">Tier 2 - Inferred</option>
            <option value="3">Tier 3 - General AI</option>
            <option value="4">Tier 4 - Traditional</option>
        </select>
        <select id="typeFilter" onchange="filterSources()">
            <option value="">All Types</option>
            <option value="rss">RSS</option>
            <option value="google">Google</option>
            <option value="gdelt">GDELT</option>
            <option value="thenewsapi">TheNewsAPI</option>
        </select>
        <select id="statusFilter" onchange="filterSources()">
            <option value="">All Status</option>
            <option value="1">Enabled</option>
            <option value="0">Disabled</option>
        </select>
        <button onclick="loadSources()" style="padding:8px 16px;background:var(--accent-orange);color:#fff;border:none;border-radius:var(--border-radius);cursor:pointer">üîÑ Refresh</button>
    </div>
    
    <div id="sourcesList">
        <div style="color:#aaa;text-align:center;padding:40px">Loading sources...</div>
    </div>
</div>

<!-- BACKLOG (Existing) -->
<div id="backlog" class="page">
    <div id="addTaskWrap">
        <div id="addTaskHeader" onclick="toggleAddTask()">
            <h2>Ôºã Add New Task</h2>
            <span id="addTaskChevron">‚ñº</span>
        </div>
        <div id="addTaskContent">
            <form class="add-form" id="addTaskForm" onsubmit="submitTask(event)">
                <div class="form-group"><label>Title</label><input type="text" id="taskTitle" required></div>
                <div class="form-group"><label>Description</label><textarea id="taskDesc"></textarea></div>
                <div class="form-group"><label>Category</label>
                    <select id="taskCategory">
                        <option value="automation">Automation</option>
                        <option value="website">Website</option>
                        <option value="discovery-engine">Discovery Engine</option>
                        <option value="database">Database</option>
                    </select>
                </div>
                <div class="form-group"><label>Priority</label>
                    <select id="taskPriority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>
                <button type="submit">Add Task</button>
            </form>
        </div>
    </div>
    
    <div class="filters">
        <div class="filter-group">
            <h3>Priority</h3>
            <label><input type="checkbox" class="filter-priority" value="critical" checked> Critical</label>
            <label><input type="checkbox" class="filter-priority" value="high" checked> High</label>
            <label><input type="checkbox" class="filter-priority" value="medium" checked> Medium</label>
            <label><input type="checkbox" class="filter-priority" value="low" checked> Low</label>
            <div class="filter-buttons"><button onclick="selectAll('filter-priority',true)">All</button><button onclick="selectAll('filter-priority',false)">None</button></div>
        </div>
        <div class="filter-group">
            <h3>Category</h3>
            <label><input type="checkbox" class="filter-category" value="automation" checked> Automation</label>
            <label><input type="checkbox" class="filter-category" value="website" checked> Website</label>
            <label><input type="checkbox" class="filter-category" value="discovery-engine" checked> Discovery</label>
            <label><input type="checkbox" class="filter-category" value="database" checked> Database</label>
            <div class="filter-buttons"><button onclick="selectAll('filter-category',true)">All</button><button onclick="selectAll('filter-category',false)">None</button></div>
        </div>
    </div>
    
    <div class="kanban" id="kanban">
        <div class="column">
            <div class="column-header"><h3>üìã To Do</h3><span class="count-pill">0</span></div>
            <div id="todo" class="cards"></div>
        </div>
        <div class="column">
            <div class="column-header"><h3>‚ö° In Progress</h3><span class="count-pill">0</span></div>
            <div id="in-progress" class="cards"></div>
        </div>
        <div class="column">
            <div class="column-header"><h3>üöß Blocked</h3><span class="count-pill">0</span></div>
            <div id="blocked" class="cards"></div>
        </div>
        <div class="column">
            <div class="column-header"><h3>‚úÖ Done</h3><span class="count-pill">0</span></div>
            <div id="done" class="cards"></div>
        </div>
    </div>
</div>

<!-- OPERATIONS (Existing) -->
<div id="operations" class="page">
    <h2>Operations Log</h2>
    <button onclick="loadOperations()" style="margin-bottom:20px">üîÑ Refresh</button>
    <div id="opsTable" style="background:var(--bg-panel);padding:15px;border-radius:var(--border-radius)">
        Loading...
    </div>
</div>

<!-- MANUAL TASKS (Existing) -->
<div id="manual" class="page">
    <h2>Manual Updates Checklist</h2>
    <div class="manual-grid">
        <div class="manual-card daily">
            <div class="manual-header"><span>üìÖ</span><h3>Daily Tasks</h3></div>
            <div class="manual-list">
                <div class="manual-item"><input type="checkbox"><label>Check automation run status</label></div>
                <div class="manual-item"><input type="checkbox"><label>Verify cards on smartpmo.ai</label></div>
                <div class="manual-item"><input type="checkbox"><label>Review discovery dashboard</label></div>
                <div class="manual-item"><input type="checkbox"><label>Check for failed sources</label></div>
            </div>
        </div>
        <div class="manual-card weekly">
            <div class="manual-header"><span>üìÜ</span><h3>Weekly Tasks</h3></div>
            <div class="manual-list">
                <div class="manual-item"><input type="checkbox"><label>Review source performance</label></div>
                <div class="manual-item"><input type="checkbox"><label>Disable low performers</label></div>
                <div class="manual-item"><input type="checkbox"><label>Check API usage limits</label></div>
            </div>
        </div>
        <div class="manual-card docs">
            <div class="manual-header"><span>üìù</span><h3>Documentation</h3></div>
            <div class="manual-list">
                <div class="manual-item"><input type="checkbox"><label>Update restart prompts</label></div>
                <div class="manual-item"><input type="checkbox"><label>Document any changes</label></div>
            </div>
        </div>
    </div>
</div>

<script>
    const API_URL = 'http://localhost:8080/api';
    let allSources = [];
    
    function updateClock(){document.getElementById('liveClock').textContent=new Date().toLocaleTimeString()}
    setInterval(updateClock,1000);updateClock();
    
    function showPage(id){
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.target.classList.add('active');
        
        if(id==='discovery')loadDiscoveryDashboard();
        if(id==='sources')loadSources();
        if(id==='backlog')loadBacklog();
        if(id==='operations')loadOperations();
    }
    
    async function loadDiscoveryDashboard(){
        try{
            const today = new Date().toISOString().split('T')[0];
            
            // Get today's run stats
            const runRes = await fetch(`${API_URL}/discovery-run/${today}`);
            if(runRes.ok){
                const run = await runRes.json();
                document.getElementById('todayArticles').textContent = run.total_articles_inserted || 0;
                document.getElementById('todayScored').textContent = run.scored || 0;
                document.getElementById('todayFetched').textContent = run.fetched || 0;
                document.getElementById('todayCards').textContent = run.cards || 0;
                document.getElementById('premiumCount').textContent = run.premium || 0;
                document.getElementById('runDuration').textContent = run.duration ? Math.round(run.duration/60) + 'm' : '0m';
                document.getElementById('runStatus').textContent = run.status || 'Ready';
                
                const statusCard = document.getElementById('statusCard');
                statusCard.className = 'stat-card ' + (run.status === 'completed' ? 'success' : run.status === 'failed' ? 'error' : '');
            }
            
            // Get top sources
            const sourcesRes = await fetch(`${API_URL}/top-sources/${today}`);
            if(sourcesRes.ok){
                const sources = await sourcesRes.json();
                const html = sources.map(s => `
                    <div class="source-item">
                        <div>
                            <div class="source-name">${s.source_name}</div>
                            <div class="source-stats">${s.articles_found} articles | Tier ${s.tier}</div>
                        </div>
                        <span class="source-status ${s.status}">${s.status}</span>
                    </div>
                `).join('');
                document.getElementById('topSources').innerHTML = html || '<div style="color:#aaa;text-align:center;padding:20px">No data for today</div>';
            }
            
        }catch(e){
            console.error('Failed to load dashboard:', e);
        }
    }
    
    async function loadSources(){
        try{
            const res = await fetch(`${API_URL}/sources`);
            allSources = await res.json();
            filterSources();
        }catch(e){
            console.error('Failed to load sources:', e);
        }
    }
    
    function filterSources(){
        const search = document.getElementById('sourceSearch').value.toLowerCase();
        const tier = document.getElementById('tierFilter').value;
        const type = document.getElementById('typeFilter').value;
        const status = document.getElementById('statusFilter').value;
        
        const filtered = allSources.filter(s => {
            if(search && !s.source_name.toLowerCase().includes(search)) return false;
            if(tier && s.tier != tier) return false;
            if(type && s.source_type != type) return false;
            if(status && s.enabled != status) return false;
            return true;
        });
        
        const html = filtered.map(s => `
            <div class="source-card tier-${s.tier}">
                <div class="source-card-header">
                    <div class="source-card-title">${s.source_name}</div>
                    <label class="toggle-switch">
                        <input type="checkbox" ${s.enabled ? 'checked' : ''} onchange="toggleSource(${s.id}, this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="source-card-meta">
                    <span>Tier ${s.tier} | ${s.source_type.toUpperCase()}</span>
                    <span>Total: ${s.total_articles_found || 0} articles</span>
                    <span>Success: ${Math.round((s.success_rate || 0) * 100)}%</span>
                    <span>Last: ${s.last_run_date ? new Date(s.last_run_date).toLocaleDateString() : 'Never'}</span>
                </div>
                <div style="margin-top:10px;font-size:12px;color:#aaa">${s.source_url || 'No URL'}</div>
            </div>
        `).join('');
        
        document.getElementById('sourcesList').innerHTML = html || '<div style="color:#aaa;text-align:center;padding:40px">No sources found</div>';
    }
    
    async function toggleSource(id, enabled){
        try{
            await fetch(`${API_URL}/sources/${id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ enabled: enabled ? 1 : 0 })
            });
            loadSources();
        }catch(e){
            console.error('Failed to toggle source:', e);
        }
    }
    
    // Backlog functions (existing)
    function toggleAddTask(){
        const content=document.getElementById('addTaskContent');
        const chevron=document.getElementById('addTaskChevron');
        const isOpen=content.classList.toggle('open');
        chevron.textContent=isOpen?'‚ñ≤':'‚ñº';
        content.style.maxHeight=isOpen?content.scrollHeight+'px':'0';
    }
    
    async function loadBacklog(){
        const r=await fetch(`${API_URL}/backlog`);
        const data=await r.json();
        const tasks=data.tasks||[];
        ['todo','in-progress','blocked','done'].forEach(c=>document.getElementById(c).innerHTML='');
        tasks.forEach((task,idx)=>{
            const card=document.createElement('div');
            card.className=`card ${task.priority}`;
            card.dataset.priority=task.priority;
            card.dataset.category=task.category;
            card.innerHTML=`<div class="card-title">${task.title}</div><div class="card-meta"><span>${task.category}</span><span>${task.priority}</span></div>`;
            document.getElementById(task.status).appendChild(card);
        });
    }
    
    async function loadOperations(){
        const res = await fetch(`${API_URL}/operations`);
        const ops = await res.json();
        const html = '<table style="width:100%;color:var(--text-light)"><tr><th>Time</th><th>Operation</th><th>Status</th><th>Message</th></tr>' +
            ops.operations.slice(0,20).map(op => {
                const d = new Date(op.timestamp);
                return `<tr><td>${d.toLocaleTimeString()}</td><td>${op.operation_type}</td><td>${op.status}</td><td>${op.message}</td></tr>`;
            }).join('') + '</table>';
        document.getElementById('opsTable').innerHTML = html;
    }
    
    function selectAll(cls,on){document.querySelectorAll('.'+cls).forEach(c=>c.checked=on)}
    
    // Init
    (async()=>{
        loadDiscoveryDashboard();
        setInterval(loadDiscoveryDashboard, 60000); // Refresh every minute
    })();
</script>
</body>
</html>